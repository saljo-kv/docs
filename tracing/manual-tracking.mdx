---
title: "Manual Tracing"
description: "Track external API calls and custom operations with detailed observability"
---

Netra's manual tracing capabilities allow you to track external API calls and custom operations with detailed observability. This section covers how to use the custom span tracking utility to monitor your application's behavior at a granular level.

## Getting Started with Manual Tracing

To start manual tracing, you'll need to:

1. Import the required classes
2. Create a new span
3. Track your operations
4. Add relevant attributes and events

Here's a basic example:

<CodeGroup>

```python python
from netra import Netra, UsageModel

# Initialize the SDK (if not already initialized)
Netra.init(app_name="Your Application Name")

# Start a new span
with Netra.start_span("image_generation") as span:
    # Your API calls or operations here
    # ...
```

</CodeGroup>

## Setting Span Attributes

You can add various attributes to your spans to provide more context about the operation:

<CodeGroup>

```python python
# Set span attributes
span.set_prompt("A beautiful sunset over mountains")
span.set_negative_prompt("blurry, low quality")
span.set_model("dall-e-3")
span.set_llm_system("openai")
```

</CodeGroup>

## Tracking Usage Data

Use the `UsageModel` to track resource usage and costs:

<CodeGroup>

```python python
# Create usage data
usage_data = [
    UsageModel(
        model="dall-e-3",
        usage_type="image_generation",
        units_used=1,
        cost_in_usd=0.02
    )
]

# Set usage data on span
span.set_usage(usage_data)
```

</CodeGroup>

## Adding Custom Attributes

Add custom attributes to provide additional context about your operation:

<CodeGroup>

```python python
# Add custom attributes
span.set_attribute("image_size", "1024x1024")
span.set_attribute("processing_time", 2.5)  # in seconds
span.set_attribute("retry_count", 0)
```

</CodeGroup>

## Recording Events

Track important events during the span's lifecycle:

<CodeGroup>

```python python
# Add events
span.add_event("generation_started", {"step": "1", "status": "processing"})
span.add_event("processing_completed", {"step": "rendering"})
span.add_event("image_generated", {"status": "success", "output_format": "png"})
```

</CodeGroup>

## Accessing OpenTelemetry Span

If you need to interact with the underlying OpenTelemetry span:

<CodeGroup>

```python python
# Get the current active OpenTelemetry span
otel_span = span.get_current_span()

# You can now use OpenTelemetry's API directly
otel_span.set_attribute("otel_key", "otel_value")
```

</CodeGroup>

## Real-world Examples

### 1. Image Generation Workflow

```python python
from netra import Netra, UsageModel

# Start span for image generation
with Netra.start_span("image_generation") as span:
    # Set initial attributes
    span.set_prompt("A futuristic cityscape")
    span.set_model("dall-e-3")
    span.set_llm_system("openai")
    
    # Track usage
    usage_data = [
        UsageModel(
            model="dall-e-3",
            usage_type="image_generation",
            units_used=1,
            cost_in_usd=0.02
        )
    ]
    span.set_usage(usage_data)
    
    # Record workflow events
    span.add_event("generation_started", {"status": "processing"})
    
    # Your actual image generation code here
    # ...
    
    span.add_event("image_generated", {"status": "success"})
```

### 2. API Request Processing

```python python
from netra import Netra, UsageModel

# Start span for API request
with Netra.start_span("api_request") as span:
    # Set request attributes
    span.set_attribute("endpoint", "/v1/images/generate")
    span.set_attribute("method", "POST")
    span.set_attribute("request_id", "req_123")
    
    # Track request processing
    span.add_event("request_received", {"timestamp": "2024-01-15T10:30:00Z"})
    
    # Process request
    # ...
    
    span.add_event("request_processed", {"status": "success", "duration_ms": 150})
```

### 3. Batch Processing

```python python
from netra import Netra, UsageModel

# Start span for batch processing
with Netra.start_span("batch_processing") as span:
    # Set batch attributes
    span.set_attribute("batch_size", 100)
    span.set_attribute("batch_id", "batch_123")
    span.set_attribute("operation", "image_enhancement")
    
    # Track batch processing
    span.add_event("batch_started", {"total_items": 100})
    
    # Process items in batch
    processed_count = 0
    for item in batch_items:
        # Process item
        # ...
        processed_count += 1
        
        if processed_count % 10 == 0:
            span.add_event("progress_update", {
                "processed": processed_count,
                "percentage": (processed_count / len(batch_items)) * 100
            })
    
    span.add_event("batch_completed", {
        "status": "success",
        "total_time_ms": 2500
    })
```

## Best Practices

1. **Use Descriptive Span Names**
   - Choose clear, meaningful names that reflect the operation
   - Follow a consistent naming convention
   - Avoid generic names like "process" or "handle"

2. **Track Important Attributes**
   - Include operation-specific attributes
   - Track resource usage and costs
   - Record timing information
   - Add error details if applicable

3. **Use Events for Workflow Tracking**
   - Mark important milestones in your operation
   - Track progress and state changes
   - Record errors and retries
   - Include timestamps for timing analysis

4. **Keep Spans Focused**
   - Each span should represent a single logical operation
   - Use nested spans for complex operations
   - Keep spans reasonably short to avoid overwhelming data

5. **Add Contextual Information**
   - Include user or session information
   - Track business metrics
   - Record environmental context
   - Add error details for troubleshooting

## Troubleshooting

1. **Span Not Showing Up**
   - Check if SDK is properly initialized
   - Verify span name is correctly formatted
   - Ensure span is properly closed
   - Check for typos in attribute names

2. **Performance Issues**
   - Use appropriate span granularity
   - Avoid excessive attribute data
   - Consider sampling for high-volume operations
   - Monitor span creation overhead

3. **Data Inconsistency**
   - Review attribute naming conventions
   - Check for attribute type mismatches
   - Validate event schemas
   - Ensure consistent context propagation

## Advanced Usage

### Nested Spans

You can create nested spans to track hierarchical operations:

<CodeGroup>

```python python
# Parent span
with Netra.start_span("parent_operation") as parent_span:
    # Child span
    with Netra.start_span("child_operation") as child_span:
        # The child span will inherit context from the parent
        # ...
```

</CodeGroup>

### Span Context Inheritance

Child spans automatically inherit context from their parent spans:

<CodeGroup>

```python python
# Set base context
with Netra.start_span("base_operation") as base_span:
    base_span.set_attribute("user_id", "user_123")
    base_span.set_attribute("session_id", "session_456")
    
    # Child span inherits these attributes
    with Netra.start_span("child_operation") as child_span:
        # Child span will have access to user_id and session_id
        # ...
```

</CodeGroup>

### Error Handling

Track errors and exceptions effectively:

<CodeGroup>

```python python
try:
    with Netra.start_span("critical_operation") as span:
        # Your operation here
        # ...
except Exception as e:
    span.add_event("error_occurred", {
        "error_type": type(e).__name__,
        "error_message": str(e),
        "stack_trace": traceback.format_exc()
    })
    raise
```

</CodeGroup>

## Common Use Cases

1. **API Request/Response Tracking**
   - Track HTTP requests and responses
   - Monitor response times
   - Track error rates
   - Record request parameters

2. **Batch Processing**
   - Track batch operations
   - Monitor progress
   - Record processing times
   - Track success/failure rates

3. **Image/Video Processing**
   - Track media processing operations
   - Monitor resource usage
   - Record processing times
   - Track quality metrics

4. **Data Processing Pipelines**
   - Track data transformation steps
   - Monitor processing stages
   - Record data volumes
   - Track error rates

5. **Machine Learning Operations**
   - Track model inference
   - Monitor resource usage
   - Record processing times
   - Track model performance metricstitle: "Manual Tracking"
description: "Welcome to the home of your new documentation"
---